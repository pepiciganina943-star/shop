{% extends 'base.html.twig' %}

{% block title %}{{ product.name }}{% endblock %}

{# --- ТУК СА МЕТА ТАГОВЕТЕ ЗА FACEBOOK --- #}
{% block meta_tags %}
    {% set imgPath = '' %}
    {% if product.coverImage %}
        {% set imgPath = 'http' in product.coverImage.filename ? product.coverImage.filename : absolute_url(asset('uploads/products/' ~ product.coverImage.filename)) %}
    {% elseif product.imageFilename %}
        {% set imgPath = 'http' in product.imageFilename ? product.imageFilename : absolute_url(asset('uploads/products/' ~ product.imageFilename)) %}
    {% else %}
        {% set imgPath = absolute_url(asset('images/placeholder.jpg')) %}
    {% endif %}

    <meta property="og:type" content="product" />
    <meta property="og:title" content="{{ product.name }} - {{ product.price }} лв." />
    <meta property="og:description" content="Ръчна изработка: {{ product.description|striptags|slice(0, 160) }}..." />
    <meta property="og:image" content="{{ imgPath }}" />
    <meta property="og:url" content="{{ app.request.uri }}" />
    <meta property="og:site_name" content="Магазин за плетени играчки" />
{% endblock %}

{% block body %}
    <div class="container mt-5 mb-5">
        <div class="row">
            {# ЛЯВА КОЛОНА: СНИМКА #}
            <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                    {% set mainImg = '' %}
                    {% if product.coverImage %}
                        {% set mainImg = 'http' in product.coverImage.filename ? product.coverImage.filename : asset('uploads/products/' ~ product.coverImage.filename) %}
                    {% elseif product.imageFilename %}
                        {% set mainImg = 'http' in product.imageFilename ? product.imageFilename : asset('uploads/products/' ~ product.imageFilename) %}
                    {% else %}
                        {% set mainImg = asset('images/placeholder.jpg') %}
                    {% endif %}
                    <img src="{{ mainImg }}" class="img-fluid w-100" alt="{{ product.name }}" style="max-height: 500px; object-fit: cover;">
                </div>
            </div>

            {# ДЯСНА КОЛОНА: ИНФО #}
            <div class="col-md-6">
                <h1 class="display-5 fw-bold mb-3">{{ product.name }}</h1>

                <div class="d-flex align-items-center mb-4">
                    <span class="h2 text-primary fw-bold mb-0 me-3">{{ product.price|number_format(2, '.', ',') }} лв.</span>
                    <span class="badge bg-success py-2 px-3">В наличност</span>
                </div>

                <p class="lead text-muted mb-4">
                    {{ product.description|raw }}
                </p>

                <hr class="my-4">

                {# БУТОНИ ЗА ДЕЙСТВИЕ #}
                <div class="d-grid gap-2">
                    {# БУТОН ДОБАВИ #}
                    <button class="btn btn-primary btn-lg rounded-pill shadow-sm">
                        <i class="fas fa-shopping-cart me-2"></i> Добави
                    </button>

                    {# БУТОН ЗА FACEBOOK SHARE #}
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ app.request.uri|url_encode }}"
                       target="_blank"
                       class="btn btn-outline-primary btn-lg rounded-pill mt-2"
                       style="color: #1877F2; border-color: #1877F2;">
                        <i class="fab fa-facebook-f me-2"></i> Сподели във Facebook
                    </a>
                </div>
            </div>
        </div>

        {# СЕКЦИЯ ПОДОБНИ ПРОДУКТИ (ако имаш подобна логика) #}
        {% if similarProducts is defined and similarProducts|length > 0 %}
            <div class="mt-5 pt-5">
                <h3 class="mb-4">Подобни продукти</h3>
                <div class="row">
                    {% for similar in similarProducts %}
                        <div class="col-6 col-md-3 mb-4">
                            {# Тук можеш да сложиш малките картички за подобни #}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
